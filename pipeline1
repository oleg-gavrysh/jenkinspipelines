pipeline {
        
    agent {label "docker-slave-ssh"}
        
    stages {
       stage("Clone") {
           steps {
            sh 'cd /var/jenkins_home/ && git clone -b $ghprbSourceBranch https://github.com/oleg-gavrysh/jenkinscripts'
           }
       }

       stage("Build") {
           steps {
           sh "bash /var/jenkins_home/jenkinscripts/build.sh "
           }
       }
      
       stage("Test") {
           steps {
            sh "bash /var/jenkins_home/jenkinscripts/test.sh >test_result.txt"
           }
       }
    }    
    post {
       always {
           writeFile file: "artifact.txt", text: "${currentBuild.result}"
           archiveArtifacts artifacts: "artifact.txt"
       }
       failure {
           archiveArtifacts artifacts: "test_result.txt"
       }
    }
}
